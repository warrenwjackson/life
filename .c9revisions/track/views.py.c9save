{"ts":1350438493513,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"import datetime\nimport traceback\n\nfrom django.core.context_processors import csrf\nfrom django.shortcuts import render_to_response, redirect\nfrom django.contrib.auth import authenticate, login\nfrom django.contrib.auth.decorators import login_required\nimport modelutils\n\ndef loginview(request):\n    c = {}\n    c.update(csrf(request))\n    return render_to_response('login.html', c)\n\ndef sign_up_in(request):\n    post = request.POST\n    if not modelutils.user_exists(post['email']): \n        user = modelutils.create_user(username=post['email'], email=post['email'], password=post['password'])\n    return auth_and_login(username=post['email'], password=post['password'], request=request, next='/')\n        \ndef auth_and_login(username, password, request, next='/'):\n    user = authenticate(username=username, password=password)\n    if user is not None:\n        login(request, user)\n        return redirect('/')\n    else:\n        return redirect('/login')    \n\n@login_required(login_url='/login/')\ndef entry(request):\n    c = {}\n    c.update(csrf(request))\n    return render_to_response('entry.html', c)\n\n@login_required(login_url='/login/')\ndef day(request):\n    user = request.user\n    if request.method == 'POST':\n        post = request.POST\n#        day = post.get('date')  #TODO: once I figure out a mobile friendly datepicker in JQuery Mobile. \n        day = datetime.date.today()\n        modelutils.record_day(user, day, happiness=post.get('happiness'), work=post.get('work'), case=post.get('case'), content=post.get('content'))\n        return redirect('/summary/')\n\n@login_required(login_url='/login/')\ndef summary(request):\n    history = modelutils.user_history(request.user)\n    happiness_work = [list(x) for x in zip(history['work'],history['happiness'])]\n    return render_to_response('display.html', locals())\n\n@login_required(login_url='/login/')\ndef io(request):\n    user = request.user\n    if request.method == 'POST':\n        success = modelutils.ingest(user, request.POST['data'])\n        if success:\n            return redirect('/summary/')\n        else:\n            data = \"There was a problem with your data.  Please reload and try again.\"\n            c = locals()\n            c.update(csrf(request))\n            return render_to_response('io.html', c)\n    else:\n        data = modelutils.data_dump(user)\n        c = locals()\n        c.update(csrf(request))\n        return render_to_response('io.html', c)\n"]],"start1":0,"start2":0,"length1":0,"length2":2422}]],"length":2422}
{"contributors":[],"silentsave":false,"ts":1350438547228,"patch":[[{"diffs":[[0,"r_to_response('io.html', c)\n"],[1,"\n"]],"start1":2394,"start2":2394,"length1":28,"length2":29}]],"length":2423,"saved":false}
